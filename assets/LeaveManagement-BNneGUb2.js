import{u as y,g as f,d as L}from"./leave-GxK9xRA2.js";import{_ as g,r as x,c as n,o as i,a as e,b as c,d as _,w as u,v as b,e as k,f as S,t as r,F as D,g as T,n as E,h as C,i as v,S as h,j as N}from"./index-CivCJXGN.js";const M={data(){return{leaves:[],selectedLeave:null,toastMessage:"",errors:{},leaveToDelete:null,selectedStatus:""}},computed:{filteredLeaves(){return this.selectedStatus?this.leaves.filter(a=>a.status===this.selectedStatus):this.leaves}},mounted(){this.leaves=f()},methods:{calculateDaysDifference(a,t){const p=new Date(a),s=new Date(t)-p;return Math.ceil(s/(1e3*60*60*24))+1},confirmDelete(a){this.leaveToDelete=a},deleteConfirmed(){L(this.leaveToDelete.id),this.leaves=f(),this.leaveToDelete=null,this.showToast("تم حذف الإجازة بنجاح")},editLeave(a){this.selectedLeave={...a}},saveEdit(){if(this.errors={},this.selectedLeave.Startdate||(this.errors.Startdate="تاريخ بداية الإجازة مطلوب"),this.selectedLeave.Endtdate||(this.errors.Endtdate="تاريخ نهاية الإجازة مطلوب"),this.selectedLeave.status||(this.errors.status="الحالة مطلوبة"),Object.keys(this.errors).length>0)return;const a=this.calculateDaysDifference(this.selectedLeave.Startdate,this.selectedLeave.Endtdate);if(!(this.leaves.find(d=>d.id===this.selectedLeave.id).status==="مقبولة")&&this.selectedLeave.status==="مقبولة"){const d=JSON.parse(localStorage.getItem(h))||N,s=d.findIndex(m=>m.name===this.selectedLeave.employeeName);if(s===-1){this.showToast("الموظف غير موجود");return}const o=d[s];if(typeof o.leaveBalance!="number"){this.showToast("رصيد الإجازات غير متوفر لهذا الموظف");return}if(o.leaveBalance<a){this.showToast(`رصيد الإجازات (${o.leaveBalance}) لا يكفي لعدد الأيام المطلوبة (${a})`);return}o.leaveBalance-=a,localStorage.setItem(h,JSON.stringify(d))}y(this.selectedLeave.id,this.selectedLeave),this.leaves=f(),this.selectedLeave=null,this.showToast("تم تعديل الإجازة بنجاح")},showToast(a){this.toastMessage=a,setTimeout(()=>this.toastMessage="",3e3)}}},B={class:"p-6 space-y-6 mt-10 mr-10",dir:"rtl"},V={class:"title"},j={class:"mb-4"},I={class:"mb-4"},U={class:"overflow-x-auto shadow rounded-lg"},z={class:"min-w-[800px] md:min-w-0"},A={class:"tbl w-full"},O={class:"tr whitespace-nowrap"},F={class:"tr whitespace-nowrap"},J={class:"tr whitespace-nowrap"},R={class:"tr whitespace-nowrap"},q={class:"tr whitespace-nowrap"},G={class:"tr whitespace-nowrap"},K={class:"tr whitespace-nowrap flex justify-center gap-2"},Y=["onClick"],H=["onClick"],P={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50"},Q={class:"bg-white p-6 rounded shadow-lg w-full max-w-md relative"},W={class:"mb-3"},X={key:0,class:"errform"},Z={class:"mb-3"},$={key:0,class:"errform"},ee={class:"mb-3"},te={key:0,class:"errform"},se={class:"mb-3"},le={key:0,class:"errform"},oe={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50"},ae={class:"bg-primary p-5 rounded shadow-md max-w-sm w-full"},re={class:"flex justify-end gap-2"},ne={key:2,class:"fixed up-4 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-4 py-2 rounded shadow z-50"};function ie(a,t,p,d,s,o){const m=x("router-link");return i(),n("section",B,[e("div",V,[t[12]||(t[12]=e("h2",{class:"txthead"},"طلبات الإجازة",-1)),e("div",j,[t[10]||(t[10]=e("label",{class:"ml-2 font-medium"},"فلترة حسب الحالة:",-1)),u(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>s.selectedStatus=l),class:"selectfilter"},t[9]||(t[9]=[e("option",{class:"",value:""},"الكل",-1),e("option",{value:"قيد المراجعة"},"قيد المراجعة",-1),e("option",{value:"مقبولة"},"مقبولة",-1),e("option",{value:"مرفوضة"},"مرفوضة",-1)]),512),[[b,s.selectedStatus]])]),_(m,{to:"/NewLeave",class:"btnAdd"},{default:k(()=>t[11]||(t[11]=[e("i",{class:"fas fa-plus mr-2"},null,-1),S(" إضافة طلب إجازة ",-1)])),_:1,__:[11]})]),e("p",I,"عدد الموظفين: "+r(o.filteredLeaves.length),1),e("div",U,[e("div",z,[e("table",A,[t[15]||(t[15]=e("thead",{class:"hd"},[e("tr",null,[e("th",{class:"tr whitespace-nowrap"},"الموظف"),e("th",{class:"tr whitespace-nowrap"},"تاريخ بداية الإجازة"),e("th",{class:"tr whitespace-nowrap"},"تاريخ نهاية الإجازة"),e("th",{class:"tr whitespace-nowrap"},"الأيام"),e("th",{class:"tr whitespace-nowrap"},"السبب"),e("th",{class:"tr whitespace-nowrap"},"الحالة"),e("th",{class:"tr whitespace-nowrap"},"إجراءات")])],-1)),e("tbody",null,[(i(!0),n(D,null,T(o.filteredLeaves,l=>(i(),n("tr",{key:l.id,class:"border-b border-border hover:bg-btnhover cursor-pointer"},[e("td",O,r(l.employeeName),1),e("td",F,r(l.Startdate),1),e("td",J,r(l.Endtdate),1),e("td",R,r(o.calculateDaysDifference(l.Startdate,l.Endtdate)),1),e("td",q,r(l.reason),1),e("td",G,[e("span",{class:E(["inline-block px-3 py-1 rounded-full text-white text-sm font-semibold whitespace-nowrap",{"bg-yellow-500":l.status==="قيد المراجعة","bg-green-600":l.status==="مقبولة","bg-red-600":l.status==="مرفوضة"}])},r(l.status),3)]),e("td",K,[e("button",{onClick:w=>o.editLeave(l),class:"btnuptate whitespace-nowrap"},t[13]||(t[13]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Y),e("button",{onClick:w=>o.confirmDelete(l),class:"btndalete whitespace-nowrap"},t[14]||(t[14]=[e("i",{class:"fas fa-trash"},null,-1)]),8,H)])]))),128))])])])]),s.selectedLeave?(i(),n("div",P,[e("div",Q,[e("button",{onClick:t[1]||(t[1]=l=>s.selectedLeave=null),class:"absolute top-2 left-2 text-red-500 text-2xl"},"×"),t[22]||(t[22]=e("h3",{class:"titleform"},"تعديل الإجازة",-1)),e("form",{onSubmit:t[6]||(t[6]=C((...l)=>o.saveEdit&&o.saveEdit(...l),["prevent"]))},[e("div",W,[t[16]||(t[16]=e("label",{class:"block mb-1 font-semibold"},"اسم الموظف:",-1)),u(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>s.selectedLeave.employeeName=l),class:"input",disabled:""},null,512),[[v,s.selectedLeave.employeeName]]),s.errors.employeeName?(i(),n("p",X,r(s.errors.employeeName),1)):c("",!0)]),e("div",Z,[t[17]||(t[17]=e("label",{class:"block mb-1 font-semibold"},"تاريخ بداية الإجازة:",-1)),u(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=l=>s.selectedLeave.Startdate=l),class:"input"},null,512),[[v,s.selectedLeave.Startdate]]),s.errors.Startdate?(i(),n("p",$,r(s.errors.Startdate),1)):c("",!0)]),e("div",ee,[t[18]||(t[18]=e("label",{class:"block mb-1 font-semibold"},"تاريخ نهايه الإجازة:",-1)),u(e("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=l=>s.selectedLeave.Endtdate=l),class:"input"},null,512),[[v,s.selectedLeave.Endtdate]]),s.errors.Endtdate?(i(),n("p",te,r(s.errors.Endtdate),1)):c("",!0)]),e("div",se,[t[20]||(t[20]=e("label",{class:"block mb-1 font-semibold"},"الحالة:",-1)),u(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>s.selectedLeave.status=l),class:"input"},t[19]||(t[19]=[e("option",{value:"قيد المراجعة"},"قيد المراجعة",-1),e("option",{value:"مقبولة"},"مقبولة",-1),e("option",{value:"مرفوضة"},"مرفوضة",-1)]),512),[[b,s.selectedLeave.status]]),s.errors.status?(i(),n("p",le,r(s.errors.status),1)):c("",!0)]),t[21]||(t[21]=e("button",{type:"submit",class:"btnsave"},"تعديل",-1))],32)])])):c("",!0),s.leaveToDelete?(i(),n("div",oe,[e("div",ae,[t[23]||(t[23]=e("h4",{class:"text-lg font-bold mb-4"},"هل أنت متأكد من حذف الإجازة؟",-1)),e("div",re,[e("button",{onClick:t[7]||(t[7]=l=>s.leaveToDelete=null),class:"px-4 py-2 bg-border rounded"},"إلغاء"),e("button",{onClick:t[8]||(t[8]=(...l)=>o.deleteConfirmed&&o.deleteConfirmed(...l)),class:"px-4 py-2 bg-red-500 text-primary rounded"},"نعم، احذف")])])])):c("",!0),s.toastMessage?(i(),n("div",ne,r(s.toastMessage),1)):c("",!0)])}const ue=g(M,[["render",ie],["__scopeId","data-v-2bb679bb"]]);export{ue as default};
